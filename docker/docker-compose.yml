version: '3.4'
services:
  namenode:
    image: uhopper/hadoop-namenode
    hostname: namenode
    container_name: namenode
    domainname: hadoop
    networks:
      - hadoop
    volumes:
      - namenode:/hadoop/dfs/name
    environment:
      - CLUSTER_NAME=data_pipeline_cluster
  datanode:
    image: uhopper/hadoop-datanode
    hostname: datanode1
    container_name: datanode1
    domainname: hadoop
    networks:
      - hadoop
    volumes:
      - datanode:/hadoop/dfs/data
    environment:
      - CORE_CONF_fs_defaultFS=hdfs://namenode:8020
  gateway:
    build:
      context: .
      dockerfile: docker/gateway/Dockerfile
    hostname: gateway
    container_name: gateway
    domainname: hadoop
    networks:
      - hadoop
    environment:
      - CORE_CONF_fs_defaultFS=hdfs://namenode:8020
    depends_on:
      - broker
      - datanode
      - namenode
  broker:
    build:
      context: docker
      dockerfile: broker/Dockerfile
    hostname: broker
    container_name: broker
    domainname: hadoop
    networks:
      - hadoop
    depends_on:
      - zookeeper
  zookeeper:
    build:
      context: docker
      dockerfile: zookeeper/Dockerfile
    hostname: zookeeper
    container_name: zookeeper
    domainname: hadoop
    networks:
      - hadoop
  flume:
    build:
      context: .
      dockerfile: docker/flume/Dockerfile
    hostname: flume
    container_name: flume
    domainname: hadoop
    networks:
      - hadoop
    environment:
      - CORE_CONF_fs_defaultFS=hdfs://namenode:8020
    depends_on:
      - broker
      - datanode
      - namenode
  nodemanager:
    image: uhopper/hadoop-nodemanager
    hostname: nodemanager1
    container_name: nodemanager1
    domainname: hadoop
    networks:
      - hadoop
    environment:
      - CORE_CONF_fs_defaultFS=hdfs://namenode:8020
      - YARN_CONF_yarn_resourcemanager_hostname=resourcemanager
      - YARN_CONF_yarn_log___aggregation___enable=true
      - YARN_CONF_yarn_nodemanager_remote___app___log___dir=/app-logs
  resourcemanager:
    image: uhopper/hadoop-resourcemanager
    hostname: resourcemanager
    container_name: resourcemanager
    domainname: hadoop
    networks:
      - hadoop
    environment:
      - CORE_CONF_fs_defaultFS=hdfs://namenode:8020
      - YARN_CONF_yarn_log___aggregation___enable=true
networks:
  hadoop:
volumes:
  namenode:
  datanode:
